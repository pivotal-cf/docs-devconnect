---
title: Deploying Developer Connect on TAS for VMs
owner: DevConnect
---

<strong><%= modified_date %></strong>

This topic describes how to deploy <%= vars.product_full %> on <%= vars.app_runtime_full %>.

## <a id="Overview"></a> Overview

To deploy <%= vars.product_short %> to <% vars.app_runtime_full %> (<%= vars.app_runtime_abbr %>)
you must configure an app manifest and variable file for <%= vars.product_short %>.
If you want to deploy <%= vars.product_short %> on Kubernetes instead,
follow the procedure in
[kubernetes-deployment](https://github.com/pivotal/DevConnect/blob/master/kubernetes-deployment) in GitHub.

To deploy <%= vars.product_short %> on <%= vars.app_runtime_abbr %>:

1. [Create the App Manifest](#manifest)
1. [Create a Variables Configuration File](#config)
1. [Push the <%= vars.product_short %> App](#push)

## <a id="prereq"></a>Prerequisites

Before you deploy <%= vars.product_short %>, you must have:

- Followed the procedures in [Configuring <%= vars.product_full %>](./configuring.html).
- A <%= vars.app_runtime_abbr %> installation with the binary buildpack installed.
- A <%= vars.product_network %> account.
- The Docker ClI. See the [Docker website](https://www.docker.com/get-started).

## <a id="manifest"></a> Create the App Manifest

<!-- The following is our speculation on how Alana will deploy DevConnect.
It should be updated after this story, https://www.pivotaltracker.com/story/show/168938874 to reflect how to actually deploy the packaged DevConnect.  -->

You must create an app manifest file to `cf push` <%= vars.product_short %>.<br><br>
To create the manifest file:

1. Create a manifest file named `devconnect-manifest.yml` in DIRECTORY.


1. Add the following contents to the manifest file:

    ```
    ---
    applications:
      - name: devconnect
        memory: 1G
        instances: 1
        routes:
        - route: ((devconnect-route))
        path: ./
        buildpacks: [ binary_buildpack ]
        command: ./devconnect-linux
        env:
          DEVCONNECTL_AUTH_CLIENT_ID: ((devconnect-auth-client-id))
          DEVCONNECTL_AUTH_CLIENT_SECRET: ((devconnect-auth-client-secret))
          DEVCONNECTL_AUTH_BASE_URL: ((devconnect-auth-base-url))
          DEVCONNECTL_SESSION_SECRET: ((session-secret))
          DEVCONNECTL_DB_TYPE: ((db-type))
          DEVCONNECTL_DB_HOST: ((db-host))
          DEVCONNECTL_DB_PORT: ((db-port))
          DEVCONNECTL_DB_USER_NAME: ((db-username))
          DEVCONNECTL_DB_NAME: ((db-name))
          DEVCONNECTL_DB_PASSWORD: ((db-password))
          DEVCONNECTL_DB_MAX_CONNECTIONS: ((db-max-connections))
          DEVCONNECTL_ENTITLEMENTS_CONFIG_STRING: ((devconnect-entitlements-config))
    ```

## <a id="config"></a> Create a Variables Configuration File

You must create a configuration file to populate variable interpolation values
for <%= vars.product_short %>.<br><br>

To create and configure the configuration file:

1. Create a configuration file named `devconnect-vars.yml` in DIRECTORY.
1. Create a `cf-mgmt` directory by running:

    ```
    mkdir -p /root/cf-mgmt-repos
    ```
    On startup, <%= vars.product_short %> clones all `cf-mgmt` repositories into this directory

1. Add credentials information to the configuration file.
  See [Add <%= vars.product_short %> and Database Credentials](#config-creds) below.
1. Add an entitlements config to the configuration file.
  See [Add the Entitlements Config](#config-entitle) below.

For an example of a configuration file, see [Example Configuration File](#example-config) below.

### <a id="config-creds"></a> Add <%= vars.product_short %> and Database Credentials

To add and configure credentials for <%= vars.product_short %> and a backing database:

1. Add the following <%= vars.product_short %> credentials to the configuration file:

    ```
    ---
    devconnect-route: DEVCONNECT-ROUTE
    devconnect-auth-client-id: LOGIN-ID
    devconnect-auth-client-secret: LOGIN-SECRET
    devconnect-auth-base-url: BASE-URL
    session-secret: SESSION-SECRET
    ```

    Where:

    <table>
      <tr>
        <th width=25%>Placeholder</th>
        <th>Value</th>
      </tr>

      <tr>
        <td><code>DEVCONNECT-ROUTE</code></td>
        <td>The route you created to access the <%= vars.product_short %> server.</td>
      </tr>

      <tr>
        <td><code>LOGIN-ID</code></td>
        <td>The login client ID you recorded in
          <a href="./configuring.html#devconnect-idp">Configure the <%= vars.product_short %> IdP</a>.
          By default, this is <code>devconnect&#95;login&#95;client</code>.</td>
      </tr>

      <tr>
        <td><code>LOGIN-SECRET</code></td>
        <td>The login client secret you recorded in
          <a href="./configuring.html#devconnect-idp">Configure the <%= vars.product_short %> IdP</a>.</td>
      </tr>

      <tr>
        <td><code>BASE-URL</code></td>
        <td>The authorization base URL you recorded in
          <a href="./configuring.html#devconnect-idp">Configure the <%= vars.product_short %> IdP</a>.</td>
      </tr>

      <tr>
        <td><code>SESSION-SECRET</code></td>
        <td>This is an arbitrary string used to encrypt session cookies.</td>
      </tr>
      </table>

1. Append the following database credentials to the configuration file:

    ```
    db-type: DATABASE-TYPE
    db-host: DATABASE-HOST
    db-port: DATABASE-PORT
    db-username: DATABASE-USERNAME
    db-name: DATABASE-NAME
    db-password: DATABASE-PASSWORD
    db-max-connections: DATABASE-CONNECTIONS
    ```
    Where:

    <table>
      <tr>
        <th width=25%>Placeholder</th>
        <th>Value</th>
      </tr>


        <tr>
          <td><code>DATABASE-TYPE</code></td>
          <td>This is the SQL database you are using with <%= vars.product_short %>.
             <%= vars.product_short %> supports <code>mysql</code> and <code>postgres</code>.</td>
        </tr>

        <tr>
          <td><code>DATABASE-HOST</code></td>
          <td>The host for your SQL database.</td>
        </tr>

        <tr>
          <td><code>DATABASE-PORT</code></td>
          <td>The port number for your SQL database.</td>
        </tr>

        <tr>
          <td><code>DATABASE-USERNAME</code></td>
          <td>The username for your SQL database.</td>
        </tr>

        <tr>
          <td><code>DATABASE-NAME</code></td>
          <td>The name of your SQL database.</td>
        </tr>

        <tr>
          <td><code>DATABASE-PASSWORD</code></td>
          <td>The password for your SQL database.</td>
        </tr>

        <tr>
          <td><code>DATABASE-CONNECTIONS</code></td>
          <td>The maximum number of connections that you want <%= vars.product_short %> to create to the database.
            You should set this value to be lower than the maximum number of concurrent connections the database permits.
            The default value is <code>3</code>.</td>
        </tr>
    </table>


### <a id="config-entitle"></a> Add Entitlements Config

The entitlements config contains configuration information in a `devconnect-entitlements-config` key
The value of this key is a YAML object with values types you must configure.

To create and configure the `devconnect-entitlements-config` key:

1. Append the following to the configuration file:

    ```
    devconnect-entitlements-config: |
    ```
1. Add org and space templates to the configuration file.
    See [Add Org and Space Templates](#config-org-space) below.
1. (Optional) Add custom template variables to the configuration file.
    See [(Optional) Add Custom Templates](#config-custom) below.
1. Add foundation information to the configuration file.
    See [Add Foundation Configurations](#config-foundation) below.


#### <a id="config-org-space"></a> Add Org and Space Templates

You can configure templates for the org and space names that <%= vars.product_short%> creates for new projects.
To configure the templates, use the `orgNameTemplate` and `spaceNameTemplate` keys.

To add and configure org and space name templates:

1. Append the following template variables to the configuration file
    in the `devconnect-entitlements-config:` section:

    ```
      orgNameTemplate: 'ORG-TEMPLATE'
      spaceNameTemplate: 'SPACE-TEMPLATE'
    ```

1. Replace `ORG-TEMPLATE` and `SPACE-TEMPLATE` with template fields.
  The following table describes the available template fields:

    <table>
      <tr>
        <th width=30%>Variable</th>
        <th>Description</th>
      </tr>

      <tr>
        <td><code>{{RandomAdjective}}</code></td>
        <td>A randomly chosen adjective</td>
      </tr>

      <tr>
        <td><code>{{RandomNoun}}</code></td>
        <td>A randomly chosen noun</td>
      </tr>

      <tr>
        <td><code>{{DeveloperUsername}}</code></td>
        <td>The username of the developer creating the project</td>
      </tr>

      <tr>
        <td><code>{{DeveloperEmail}}</code></td>
        <td>The email address of the developer creating the project</td>
      </tr>

      <tr>
        <td><code>{{RegionName}}</code></td>
        <td>The region that the foundation is located in</td>
      </tr>

      <tr>
        <td><code>{{EnvironmentName}}</code></td>
        <td>The name of the environment</td>
      </tr>

      <tr>
        <td><code>{{ProjectName}}</code></td>
        <td>The project name the developer sets when they create the project</td>
      </tr>
    </table>
    <br>
    For example:

    ```ruby
    {{RandomAdjective}}-{{ProjectName}}-{{DeveloperUsername}}-{{EnvironmentName}}
    ```


#### <a id="config-custom"></a> (Optional) Add Custom Templates

You can define custom template variables
and use these variables in the `orgNameTemplate` and `spaceNameTemplate` keys.
You can create more than one custom template.

To add and configure custom templates:

1. Append the following template variables to the configuration file
    in the `devconnect-entitlements-config:` section:

    ```
    customTemplateVariables:
    - variableName: CUSTOM-VAR
      displayName: CUSTOM-VAR-DISPLAY
      displayText: CUSTOM-VAR-DISPLAY-TEXT
      characterLimit: CHAR-LIMIT
    ```

    Where:
    <table>
      <tr>
        <th width="33%">Field</th>
        <th>Description</th>
      </tr>

      <tr>
        <td><code>CUSTOM-VAR</code></td>
        <td>(Required) The variable name used in the <code>orgNameTemplate</code>
          or <code>spaceNameTemplate</code> key.</td>
      </tr>

      <tr>
        <td><code>CUSTOM-VAR-DISPLAY</code></td>
        <td>(Required) The UI label used to identify the field.</td>
      </tr>

      <tr>
        <td><code>CUSTOM-VAR-DISPLAY-TEXT</code></td>
        <td>The placeholder text shown in the UI field.</td>
      </tr>

      <tr>
        <td><code>CHAR-LIMIT</code></td>
        <td>(Required) The maximum number of permitted characters for a field.</td>
      </tr>
    </table><br>

    For example:

    ```
    customTemplateVariables:
    - variableName: CostCenter
      displayName: Cost Center
      displayText: Please enter your Cost Center
      characterLimit: 10
    ```

#### <a id="config-cf-mgmt"></a> Add the cf-mgmt Directory

On startup, <%= vars.product_short %> clones all `cf-mgmt` repositories into this directory.
You created this directory in [Create a Variables Configuration File](#config) above.

1. Append the following line to the configuration file
    in the `devconnect-entitlements-config:` section

    ```
    CFMgmtClonedReposDir: /root/cf-mgmt-repos
    ```

#### <a id="config-foundation"></a> Add Foundation Configurations

You must add information for each foundation you want to add to <%= vars.product_short %>.
You add the foundation information to a `foundations` array.

To add and configure the `foundations` array:

1. Append the following identification information to the configuration file
    in the `devconnect-entitlements-config:` section:

    ```
    1. Append the following line to the configuration file:

    ```
    foundations:
    - name: "FOUNDATION-NAME"
      uuid: "FOUNDATION-UUID"
      region: "FOUNDATION-REGION"
      apiUrl: "FOUNDATION-URL"
    ```
    Where:

    <table>

      <tr>
        <th width="28%">Placeholder</th>
        <th>Description</th>
      </tr>

      <tr>
        <td><code>FOUNDATION-NAME</code></td>
        <td>A human-readable name for the foundation.</td>
      </tr>

      <tr>
        <td><code>FOUNDATION-UUID</code></td>
        <td>The generated UUID for the foundation.</td>
      </tr>

      <tr>
        <td><code>FOUNDATION-REGION</code></td>
        <td>The region that the foundation is located in.
          This is used to group foundations and environments together.</td>
      </tr>

      <tr>
        <td><code>FOUNDATION-URL</code></td>
        <td>The Cloud Foundry API (CAPI) URL for the foundation.</td>
      </tr>

    </table>

1. Append the following `cf-mgmt` credentials information to the configuration file
    in the `devconnect-entitlements-config:` section:

    ```
    cfMgmtRepo:
      configDir: CONFIG-DIRECTORY
      repoUrl: REPO-URL
      privateKey: |
        PRIVATE-KEY
      privateKeyPassPhrase: PASSWORD
    ```
      Where:
      <table>

      <tr>
        <th width="29%">Placeholder</th>
        <th>Description</th>
      </tr>

      <tr>
        <td><code>CONFIG-DIRECTORY</code></td>
        <td>The name of your `cf-mgmt` configuration directory</td>
      </tr>

      <tr>
        <td><code>REPO-URL</code></td>
        <td>The URL for your `cf-mgmt` configuration Git repository </td>
      </tr>

      <tr>
        <td><code>PRIVATE-KEY</code></td>
        <td>The private key for your `cf-mgmt` configuration Git repository.</td>
      </tr>

      <tr>
        <td><code>PASSWORD</code></td>
        <td>The passphrase for your `cf-mgmt` configuration Git repository</td>
      </tr>

    </table>
    <br>
    For example:

    ```
    cfMgmtRepo:
      configDir: alternate-config-name
      repoUrl: git@example.com:user/repo.git
      privateKey: |
        -----BEGIN RSA PRIVATE KEY-----
        abcdEFGhIKlmfdskjlfdsfsnjwjnfDHFLDKSNLfjhkldsfnlsFDFDgdj
                  ...
        -----END RSA PRIVATE KEY-----
      privateKeyPassPhrase: password
    ```

1. Append the following OAuth information to the configuration file
    in the `devconnect-entitlements-config:` section:

    ```
    oauth:
      authorizeUrl: https://login.sys.FOUNDATION-DOMAIN/oauth/authorize
      tokenUrl: https://login.sys.FOUNDATION-DOMAIN/oauth/token
      clientId: AUTH-CLIENT-ID
      clientSecret: AUTH-CLIENT-SECRET
      issuerUrl: https://uaa.sys.FOUNDATION-DOMAIN/oauth/token
      jwksUrl: https://login.sys.FOUNDATION-DOMAIN/token_keys
      authenticationType: IDENTITY-PROVIDER
    ```
    Where:
    <table>

      <tr>
        <th width="29%">Placeholder</th>
        <th>Description</th>
      </tr>

      <tr>
        <td><code>FOUNDATION-DOMAIN</code></td>
        <td>The domain name for the foundation.</td>
      </tr>

      <tr>
        <td><code>AUTH-CLIENT-ID</code></td>
        <td>The authorization client ID you recorded in
          <a href="./configuring.html#auth-creds">Configure Authorization Code Client Credentials</a>.
          By default, this is <code>devconnect&#95;foundation&#95;auth&#95;client</code>.</td>
      </tr>

      <tr>
        <td><code>AUTH-CLIENT-SECRET</code></td>
        <td>The authorization client secret you recorded in
          <a href="./configuring.html#auth-creds">Configure Authorization Code Client Credentials</a>.</td>
      </tr>

      <tr>
        <td><code>IDENTITY-PROVIDER</code></td>
        <td>The type of identity provider that backs the foundation.
          <%= vars.product_short%> supports  <code>saml</code>, <code>internal</code>, and <code>ldap</code>.</td>
      </tr>

    </table>
    <br>

    <%= vars.product_short%> uses the OAuth information to verify users for login.
        <p class="note"><strong>Note:</strong> These values can be
        retrieved by querying the UAA well-known OpenID config endpoint:
        <code>https<span>:</span>//uaa.sys.FOUNDATION-DOMAIN/.well-known/openid-configuration</code>.
        </p>

1. Append the following environment information to the configuration file
    in the `devconnect-entitlements-config:` section:

    ```
    tutorialEnvironment:
       name: sandbox
       orgRole: auditors
       spaceRole: developers
       quotaName: FOUNDATION-QUOTA
    environments:
    - name: dev
      orgRole: auditors
      spaceRole: developers
    - name: prod
      orgRole: auditors
      spaceRole: auditors
    ```

    Where `FOUNDATION-QUOTA` is the quota name that is used by the tutorial environment.
    This quota name must exist on the foundation. <br><br>

    The following table describes the environment keys:

    <table>

      <tr>
        <th>Keys</th>
        <th>Description</th>
      </tr>

      <tr>
        <td>tutorialEnvironment</td>
        <td>The environment that is used for the tutorial</td>
      </tr>

      <tr>
        <td>tutorialEnvironment.name</td>
        <td>The name of the tutorial environment</td>
      </tr>

      <tr>
        <td>tutorialEnvironment.orgRole</td>
        <td>The org role that is used for the tutorial environment.</td>
      </tr>

      <tr>
        <td>tutorialEnvironment.spaceRole</td>
        <td>The space role that is used for the tutorial environment.</td>
      </tr>

      <tr>
        <td>tutorialEnvironment.quotaName</td>
        <td>The quota name that is used by the tutorial environment.
        This quota name must exist on the foundation. </td>
      </tr>

      <tr>
        <td>environments</td>
        <td>The list of environments on the foundation.</td>
      </tr>

      <tr>
        <td>environments[].name</td>
        <td>The name of the environment</td>
      </tr>

      <tr>
        <td>environments[].orgRole</td>
        <td>The org role that <% vars.product_short %> assigns to the user.
            The user is also added to the <code>users</code> group.</td>
      </tr>

      <tr>
        <td>environments[].spaceRole</td>
        <td>The space role that <% vars.product_short %> assigns to the user. </td>
      </tr>

    </table>


### <a id="example-config"></a> Example Configuration File

The following is a example of an configuration file:

```
---
devconnect-route: DEVCONNECT-ROUTE
devconnect-auth-client-id: LOGIN-ID
devconnect-auth-client-secret: LOGIN-SECRET
devconnect-auth-base-url: BASE-URL
session-secret: SESSION-SECRET
db-type: DATABASE-TYPE
db-host: DATABASE-HOST
db-port: DATABASE-PORT
db-username: DATABASE-USERNAME
db-name: DATABASE-NAME
db-password: DATABASE-PASSWORD
db-max-connections: DATABASE-CONNECTIONS
devconnect-entitlements-config: |
    orgNameTemplate: 'ORG-TEMPLATE'
    spaceNameTemplate: 'SPACE-TEMPLATE'
    customTemplateVariables:
    - variableName: CUSTOM-VAR
      displayName: CUSTOM-VAR-DISPLAY
      displayText: CUSTOM-VAR-DISPLAY-TEXT
      characterLimit: CHAR-LIMIT
    CFMgmtClonedReposDir: /root/cf-mgmt-repos
    foundations:
      - name: "FOUNDATION-NAME"
        uuid: "FOUNDATION-UUID"
        region: "FOUNDATION-REGION"
        apiUrl: "FOUNDATION-URL"
      cfMgmtRepo:
        configDir: CONFIG-DIRECTORY
        repoUrl: REPO-URL
        privateKey: |
          PRIVATE-KEY
        privateKeyPassPhrase: PASSWORD
      oauth:
        authorizeUrl: https://login.sys.FOUNDATION-DOMAIN/oauth/authorize
        tokenUrl: https://login.sys.FOUNDATION-DOMAIN/oauth/token
        clientId: AUTH-CLIENT-ID
        clientSecret: AUTH-CLIENT-SECRET
        issuerUrl: https://uaa.sys.FOUNDATION-DOMAIN/oauth/token
        jwksUrl: https://login.sys.FOUNDATION-DOMAIN/token_keys
        authenticationType: IDENTITY-PROVIDER
      tutorialEnvironment:
         name: sandbox
         orgRole: auditors
         spaceRole: developers
         quotaName: FOUNDATION-QUOTA
      environments:
      - name: dev
        orgRole: auditors
        spaceRole: developers
      - name: prod
        orgRole: auditors
        spaceRole: auditors
```

## <a id="push"></a>Push the <%= vars.product_short %> App

To push the <%= vars.product_short %> app:

1. Log in to the registry by...

1. Download the <%= vars.product_short %> container image by running:

    ```
    docker pull registry.pivotal.io/developer-connect/developer-connect:latest
    ```
1. Target your CAPI endpoint by running:

    ```
    cf api CF-API-ENDPOINT
    ```
1. Log into your deployment by running:

    ```
    cf login
    ```
1. Push <%= vars.product_short %> by running:

    ```
    CF_DOCKER_PASSWORD=VMWARE-NETWORK-PASSWORD  \
    cf push -f devconnect-manifest.yml --vars-file devconnect-vars.yml
    ```
    Where `VMWARE-NETWORK-PASSWORD` is the password you used to log in to <%= vars.product_network %>.
